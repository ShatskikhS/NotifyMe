Отлично — идеальный выбор.
Значит делаем **внутреннее инженерное ТЗ на русском**, практичное, без лишней бюрократии, но с чёткой логикой: что должно быть, зачем и в каком виде.
Такой документ можно будет реально использовать как *путеводитель по проекту* и обновлять по мере развития NotifyMe.

---

ниже — готовое **Техническое задание (ТЗ)** для проекта **NotifyMe**
(оформлено в Markdown, ты сможешь просто сохранить как `docs/TECH_SPEC.md`).

---

# Техническое задание (ТЗ)

## Проект: **NotifyMe**

**Описание:** серверное приложение на Node.js (Express), предоставляющее REST API для приёма, хранения, планирования и доставки персональных уведомлений через различные каналы (Telegram, email, лог-файл, консоль и др.).

---

## 1. Цели проекта

1. Реализовать API-сервис для централизованной обработки уведомлений из разных источников.
2. Обеспечить возможность:

   * моментальной отправки уведомлений;
   * отложенной доставки по заданному времени;
   * управления запланированными уведомлениями (просмотр, отмена и т.п.).
3. Поддержать расширяемую архитектуру доставки уведомлений (модули каналов).

---

## 2. Основной функционал (MVP)

### 2.1 Создание уведомления

**POST /notify**

**Входные данные (JSON):**

```json
{
  "source": "backup_script",
  "priority": "high",
  "message": "Backup completed successfully",
  "channels": ["telegram", "logfile"],
  "sendAt": "2025-10-21T08:00:00Z"
}
```

**Ответ:**

```json
{
  "status": "accepted",
  "id": "notif_123456",
  "scheduled": true
}
```

**Описание поведения:**

* если `sendAt` отсутствует → уведомление отправляется сразу;
* если `sendAt` указано → уведомление сохраняется в очередь и выполняется при наступлении указанного времени.

---

### 2.2 Управление уведомлениями

| Метод                       | Маршрут                                              | Назначение |
| --------------------------- | ---------------------------------------------------- | ---------- |
| `GET /notifications`        | список всех уведомлений (активных и завершённых)     |            |
| `GET /notifications/:id`    | получение информации по конкретному уведомлению      |            |
| `DELETE /notifications/:id` | отмена запланированного уведомления                  |            |
| `PATCH /notifications/:id`  | изменение времени или каналов доставки (опционально) |            |

---

### 2.3 История и статистика

| Метод            | Маршрут                                      | Назначение |
| ---------------- | -------------------------------------------- | ---------- |
| `GET /history`   | история уведомлений за период (`?from=&to=`) |            |
| `GET /failed`    | уведомления, не доставленные по ошибке       |            |
| `GET /delivered` | успешно доставленные уведомления             |            |

---

## 3. Архитектура проекта

### 3.1 Структура директорий

```
src/
  app.js
  routes/
    notify.js
    notifications.js
  controllers/
    notifyController.js
    notificationsController.js
  services/
    notifyService.js
    schedulerService.js
    channels/
      console.js
      file.js
      telegram.js
  models/
    notificationModel.js
  middlewares/
    errorHandler.js
    validate.js
  logger.js
  config.js
logs/
.env
```

### 3.2 Поток обработки уведомления

```
POST /notify
→ Router → Controller → Validation (Joi)
→ NotifyService → Scheduler (если sendAt)
→ выбранные каналы → логирование результата
```

---

## 4. Хранение данных

На этапе MVP уведомления могут храниться:

* в памяти (в структуре данных внутри приложения);
* в JSON-файле (при необходимости персистентности между перезапусками).

Планируется возможность замены на SQLite или MongoDB без изменения API.

---

## 5. Технические требования

| Компонент                | Используемая технология                    |
| ------------------------ | ------------------------------------------ |
| Web-сервер               | Express.js                                 |
| Безопасность             | helmet, express-rate-limit, xss-clean, hpp |
| Валидация входных данных | Joi                                        |
| Планировщик задач        | node-schedule                              |
| Логирование              | Winston                                    |
| Конфигурация окружения   | dotenv                                     |
| Формат логов             | JSON + цветная консоль в dev               |
| Кодировка                | UTF-8                                      |
| Node.js                  | ≥ v18                                      |

---

## 6. API-ответы (общие правила)

* Все ответы возвращаются в формате JSON.
* В случае ошибки структура ответа:

  ```json
  {
    "status": "error",
    "message": "Описание ошибки"
  }
  ```
* При успешных операциях:

  ```json
  {
    "status": "ok",
    "data": {...}
  }
  ```
* Для ошибок валидации — код `400 Bad Request`,
  для несуществующих уведомлений — `404 Not Found`,
  для внутренних ошибок — `500 Internal Server Error`.

---

## 7. Безопасность

1. Использовать middleware `helmet`, `xss-clean`, `hpp`, `express-rate-limit`.
2. Поддержка CORS только для доверенных источников (настраивается через `.env`).
3. Возможность добавить токен API (через заголовок `Authorization`) для аутентификации запросов.

---

## 8. Логирование

* Все операции записываются через Winston:

  * `info` — успешные действия;
  * `error` — ошибки;
  * `http` — входящие запросы (через morgan → winston).
* Отдельные файлы:

  ```
  logs/combined.log
  logs/error.log
  logs/exceptions.log
  ```

---

## 9. Критерии готовности (MVP)

1. Реализованы маршруты `POST /notify`, `GET /notifications`, `DELETE /notifications/:id`.
2. Работает отложенная доставка через `node-schedule`.
3. Есть базовая валидация входных данных (Joi).
4. Логи записываются в файл.
5. Обработка ошибок централизована.
6. Все настройки вынесены в `.env`.

---

## 10. План тестирования

| Задача                             | Проверка                         |
| ---------------------------------- | -------------------------------- |
| Создание мгновенного уведомления   | сообщение появляется в логах     |
| Создание отложенного уведомления   | срабатывает по таймеру           |
| Отмена уведомления                 | не срабатывает после отмены      |
| Обработка ошибки канала            | запись в error.log               |
| Некорректные данные в POST-запросе | ответ 400 с сообщением об ошибке |

---

## 11. Возможные дальнейшие этапы

* Подключение базы данных для хранения истории уведомлений.
* Добавление Telegram-канала (через Bot API).
* Реализация аутентификации токеном.
* Создание веб-интерфейса для просмотра и управления уведомлениями.
* Интеграция с внешними сервисами (Email, Slack, Pushbullet и т.д.).

---

**Версия документа:** 1.0
**Автор:** Sergei Shatskikh
**Дата:** 20.10.2025

---

Хочешь, чтобы я помог сразу подготовить шаблон папок и файлов под этот проект (с пустыми `.js`-файлами и базовыми комментариями, чтобы структура уже была на месте)?
Это не код, а просто каркас проекта — чтобы сразу можно было начать заполнять.

